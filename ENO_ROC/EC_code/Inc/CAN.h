////////////////////////////////////////////////////////////////////////////////////////////////////
// fileName: can.h
//
// Description: Low level CAN functions
//
// Author: Enovation controls
//
//         http://www.enovationcontrols.com
//
// copyright Copyright 2024 by Enovation Controls.
//           This file and/or parts of it are subject to
//            software license terms.
//
//            Without written approval of Enovation Controls this
//            software may not be copied, redistributed or used
//            in any other way.
//
////////////////////////////////////////////////////////////////////////////////////////////////////

#ifndef CAN_H
#define CAN_H

////////////////////////////////////////////////////////////////////////////////////////////////////
// Includes
////////////////////////////////////////////////////////////////////////////////////////////////////
#include <stdbool.h>
#include <stdint.h>
#include <stm32l4xx_hal.h>


////////////////////////////////////////////////////////////////////////////////////////////////////
// Defines
////////////////////////////////////////////////////////////////////////////////////////////////////
// PGN requests
#define CAN_FIFO_DEPTH							8
#define CAN_SOURCE_ADDRESS						123

////////////////////////////////////////////////////////////////////////////////////////////////////
// Typedefs
////////////////////////////////////////////////////////////////////////////////////////////////////
extern CAN_HandleTypeDef hcan1;
extern CAN_TxHeaderTypeDef CAN_tx_header; 		//header for message transmissions
extern CAN_RxHeaderTypeDef CAN_rx_header; 		//header for message reception


////////////////////////////////////////////////////////////////////////////////////////////////////
// Private variables
////////////////////////////////////////////////////////////////////////////////////////////////////
//CAN RX FIFO
extern uint8_t can_fifo_in_pointer;
extern uint8_t can_fifo_out_pointer;
extern uint32_t can_fifo_arbid[CAN_FIFO_DEPTH];
extern uint8_t can_fifo_dlen[CAN_FIFO_DEPTH];
extern uint8_t can_fifo_data[CAN_FIFO_DEPTH][8];
extern uint32_t CAN_tx_mailbox;

extern uint8_t can_tx_data[8];
extern uint8_t can_rx_data[8];

extern uint32_t can_rx_count;
extern uint32_t can_tx_count;

//J1939 variables
extern uint16_t j1939EngineSpeed;
extern uint16_t j1939EngineOilPressure;
extern int16_t j1939EngineCoolantTemp;
extern uint16_t j1939EngineLoad;


////////////////////////////////////////////////////////////////////////////////////////////////////
// Private interface
////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////
// Public interface
////////////////////////////////////////////////////////////////////////////////////////////////////

//
void CAN_transmit_coms();

//
void CAN_receive_coms();

//
void CAN_InitTask(void);


#endif











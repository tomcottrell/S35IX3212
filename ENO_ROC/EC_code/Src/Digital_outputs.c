////////////////////////////////////////////////////////////////////////////////////////////////////
// fileName: Digital_outputs.c
//
// Description: Digital output control
//
// Author: Enovation controls
//
//         http://www.enovationcontrols.com
//
// copyright Copyright 2024 by Enovation Controls.
//            This file and/or parts of it are subject to
//            software license terms.
//
//            Without written approval of Enovation Controls this
//            software may not be copied, redistributed or used
//            in any other way.
//
////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////
// Includes
////////////////////////////////////////////////////////////////////////////////////////////////////
#include <stdbool.h>
#include <stdint.h>
#include <stm32l4xx_hal.h>
#include <main.h>
#include <Digital_outputs.h>

////////////////////////////////////////////////////////////////////////////////////////////////////
//Defines
////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////
// Typedefs
////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////
// Private variables
////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////
// Private interface
////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////
// Public interface
////////////////////////////////////////////////////////////////////////////////////////////////////
//TIM_HandleTypeDef htim3;
bool Output1_control = 0;
bool Output2_control = 0;
uint8_t LCD_brightness = 50;

////////////////////////////////////////////////////////////////////////
//
// digital_output_control()
//
// Sets the state of the digital outputs.
//
//    Parameters:
//			none
//
//    Returns:
// 			none
//
////////////////////////////////////////////////////////////////////////
void digital_output_control()
{
	uint32_t backlight_pwm_value;


	//Digital OP 1
	HAL_GPIO_WritePin(DIGITAL_OUT1_GPIO_Port, DIGITAL_OUT1_Pin, Output1_control);

	//Digital OP 2
	HAL_GPIO_WritePin(DIGITAL_OUT2_GPIO_Port, DIGITAL_OUT2_Pin, Output2_control);

	//LCD backlight control
	backlight_pwm_value = TIMER2_COUNTER_PERIOD;		//Timer 2 counter period
	backlight_pwm_value *= LCD_brightness;
	backlight_pwm_value /= 100;

	if(backlight_pwm_value < 1)
		backlight_pwm_value = 1;
	else if(backlight_pwm_value > TIMER2_COUNTER_PERIOD)
		backlight_pwm_value = TIMER2_COUNTER_PERIOD;

	TIM2->CCR2 = backlight_pwm_value;
}

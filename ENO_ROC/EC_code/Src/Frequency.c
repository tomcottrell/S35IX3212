////////////////////////////////////////////////////////////////////////////////////////////////////
// fileName: Frequency.c
//
// Description: Frequency measurement
//
// Author: Enovation controls
//
//         http://www.enovationcontrols.com
//
// copyright Copyright 2024 by Enovation Controls.
//            This file and/or parts of it are subject to
//            software license terms.
//
//            Without written approval of Enovation Controls this
//            software may not be copied, redistributed or used
//            in any other way.
//
////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////
// Includes
////////////////////////////////////////////////////////////////////////////////////////////////////
#include <stdbool.h>
#include <stdint.h>


////////////////////////////////////////////////////////////////////////////////////////////////////
//Defines
////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////
// Typedefs
////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////
// Private variables
////////////////////////////////////////////////////////////////////////////////////////////////////
extern bool frequency_valid;
extern uint16_t frequency;
extern uint32_t freq_timer;

////////////////////////////////////////////////////////////////////////////////////////////////////
// Private interface
////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////
// Public interface
////////////////////////////////////////////////////////////////////////////////////////////////////
uint16_t frequency = 0xFFFF;
uint8_t freq_sample_count = 0;
uint32_t freq_timer = 0;
uint32_t timer6_byte3 = 0;
bool frequency_valid = false;


////////////////////////////////////////////////////
// Process frequency measurement from pulse count //
////////////////////////////////////////////////////
void process_frequency_measurement()
{
	if(frequency_valid)
		frequency = (19.68e6 / freq_timer);
	else
		frequency = 0xFFFF;
}

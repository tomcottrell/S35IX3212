# Thread safety 

These files were copied from the ThreadSafe folder, generated by CubeMX, 
when Multi-Threading is configured in the project management.

The USB-Device stack from ST uses unsafe memory allocations from within an ISR, for that reason 
the option **STM32_THREAD_SAFE_STRATEGY 4: Allow lock usage from interrupts** is selected.
In order to make memory allocations thread-safe, a locking mechanism is implemented.
However, that requires disabling interrupts during these allocations, that might have
implications on the performance. Higher level ISR are not disabled.

To incorporate bugfixes ST still hasn't included in their files, the option in the project
manager is disabled and the files modified and used from this folder, to prevent them from being overwritten
by CubeMX code-generation.

## printf & newlib 

As long as the context, e.g. FreeRtos Task, has enough allocated heap space to use, implicit calls
from libraries to malloc will be safe.
*printf* when using floating number support, allocates up to 200 bytes!
If functionality like printf is required and used in production code, it is best to replace it by an
alternate implementation, for example: 

https://github.com/mpaland/printf